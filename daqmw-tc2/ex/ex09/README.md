(テーマ)ネットワークからデータを読みデコードする
================================================

実習内容
--------

* ネットワークから送られてくるデータをncコマンドを使ってセーブする。
* 送られてきたデータをncコマンドを使って読みデコードする。

ボードの説明
------------

データフォーマットについてはすでに説明したとおり。

本来はなにかトリガーをかける回路を用意したいところであるが
準備が大変なので、お手軽にUDPでパケットを送るとトリガーが
かかるようなFPGAファームウェアを作った。

データはTCPで送られてくる。ボードのIPアドレスは192.168.10.16、
ポートは24である。

データをncコマンドを使ってセーブする
------------------------------------

TCPで送られてくるデータはLinux上でncコマンドで読むことが
できる。

    % nc 192.168.10.16 24 > data

としてボートとTCPで接続する。まだトリガーがかかっていない
のでデータはやってきていない(別ターミナルを開いてls -l dataを
実行しファイルサイズをみることで確認できる)。

トリガーをかけるために

    % ~/daqmw-tc/trigger/trigger.py

を起動する。startボタンを押すとUDPパケットが送られ、トリガーがかかる
(トリガーレートのデフォルトは10Hzにセットされている)。
数秒後にstopボタンを押す。dataファイルに読んだデータが入っている。
バイナリなのでcatコマンドで内容は表示することはできない。
hexdumpコマンドで16進数ダンプで表示することができる。

    % hexdump -vC data

パイプで接続
------------

すでにファイルを読んでデコードするプログラムを書いたのでこれを
改造してパイプでつないでネットワークからデータを読んでデコードするように
改造する。

    % nc 192.168.10.16 24 | ./decode_program

として起動するとncからの出力がdecode_programに標準入力として
入力される。標準入力のファイルハンドラはプログラム起動時に
すでにstdinとして使えるようになっている。

    FILE *fp;
    fp = fopen("data", "r");

となっていた部分(およびfopen()エラー処理部分)を

    fp = stdin;

とすると標準入力を読むようになるのですでに書いたコードを変更し
試してみる。
